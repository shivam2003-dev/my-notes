# Docker Troubleshooting Cheatsheet: Fundamentals & Installation Issues

## Docker Installation Troubleshooting

### Windows-Specific Issues

**WSL2 Requirements Not Met**
```bash
# Check WSL version
wsl --list --verbose

# Update WSL2
wsl --update
wsl --set-default-version 2
```

**Hyper-V Not Enabled**
```powershell
# Run in PowerShell as Administrator
Enable-WindowsOptionalFeature -Online -FeatureName Microsoft-Hyper-V -All
DISM /Online /Enable-Feature /All /FeatureName:Microsoft-Hyper-V
```

**Docker Desktop Won't Start**
```bash
# Reset Docker Desktop
"C:\Program Files\Docker\Docker\Docker Desktop.exe" --reset-to-factory

# Check Windows Services
services.msc
# Verify Docker Desktop Service is running
```

### macOS-Specific Issues

**Rosetta 2 Missing (Apple Silicon)**
```bash
# Install Rosetta 2 for M1/M2 Macs
sudo softwareupdate --install-rosetta
```

**Permission Issues with Docker Desktop**
```bash
# Fix Docker Desktop permissions
sudo chown -R $(whoami) ~/.docker
sudo chmod -R 755 ~/.docker
```

**Kernel Extension Issues**
```bash
# Allow kernel extensions in System Preferences
# System Preferences → Security & Privacy → General → Allow
```

### Linux-Specific Issues

**Package Repository Issues**
```bash
# Ubuntu/Debian - Update repositories
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg

echo "deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list

# CentOS/RHEL - Add repository
sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
```

**Conflicting Packages**
```bash
# Remove old Docker versions
sudo apt-get remove docker docker-engine docker.io containerd runc
sudo yum remove docker docker-client docker-client-latest docker-common
```

## Permission Problems

### Docker Group Configuration

**Add User to Docker Group**
```bash
# Add current user to docker group
sudo usermod -aG docker $USER

# Apply group changes without logout
newgrp docker

# Verify group membership
groups $USER
id $USER
```

**Permission Denied for Docker Socket**
```bash
# Check socket permissions
ls -la /var/run/docker.sock

# Fix socket permissions (temporary)
sudo chmod 666 /var/run/docker.sock

# Fix socket permissions (permanent)
sudo chown root:docker /var/run/docker.sock
sudo chmod 660 /var/run/docker.sock
```

### Root vs Non-Root Issues

**Running Docker as Non-Root**
```bash
# Install Docker in rootless mode
curl -fsSL https://get.docker.com/rootless | sh

# Set environment variables
export PATH=/home/$USER/bin:$PATH
export DOCKER_HOST=unix:///run/user/$(id -u)/docker.sock
```

## Docker Daemon Issues

### Service Management

**Systemd Service Issues**
```bash
# Check Docker daemon status
sudo systemctl status docker

# Start Docker daemon
sudo systemctl start docker
sudo systemctl enable docker

# Restart Docker daemon
sudo systemctl restart docker

# View daemon logs
sudo journalctl -u docker.service -f
```

**Manual Daemon Startup**
```bash
# Start daemon manually for debugging
sudo dockerd --debug

# Start with specific configuration
sudo dockerd --config-file /etc/docker/daemon.json
```

### Socket Connection Errors

**Cannot Connect to Docker Daemon**
```bash
# Check if daemon is running
ps aux | grep docker

# Check socket existence
ls -la /var/run/docker.sock

# Test socket connection
docker version
docker info
```

**Docker Daemon Socket Issues**
```bash
# Kill existing daemon processes
sudo pkill dockerd
sudo pkill docker-containerd

# Remove socket file
sudo rm /var/run/docker.sock

# Restart Docker service
sudo systemctl restart docker
```

### Daemon Configuration Issues

**Invalid Daemon Configuration**
```bash
# Validate daemon.json syntax
cat /etc/docker/daemon.json | python -m json.tool

# Common daemon.json template
sudo tee /etc/docker/daemon.json <<EOF
{
  "storage-driver": "overlay2",
  "log-driver": "json-file",
  "log-opts": {
    "max-size": "10m",
    "max-file": "3"
  }
}
EOF
```

## Basic Command Failures

### Command Not Found Errors

**Docker Command Not Found**
```bash
# Check if Docker is installed
which docker
docker --version

# Check PATH variable
echo $PATH

# Add Docker to PATH (if installed in custom location)
export PATH=$PATH:/usr/local/bin
echo 'export PATH=$PATH:/usr/local/bin' >> ~/.bashrc
```

**Docker Compose Not Found**
```bash
# Install Docker Compose
sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose

# Create symbolic link
sudo ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose
```

### PATH Issues

**Docker Binary Location**
```bash
# Find Docker installation
find / -name "docker" -type f 2>/dev/null

# Common Docker locations
/usr/bin/docker
/usr/local/bin/docker
/snap/bin/docker
```

**Fix PATH for Docker**
```bash
# Temporary PATH fix
export PATH=$PATH:/usr/bin:/usr/local/bin

# Permanent PATH fix
echo 'export PATH=$PATH:/usr/bin:/usr/local/bin' >> ~/.profile
source ~/.profile
```

## Diagnostic Commands

### System Information
```bash
# Docker system information
docker system info
docker version

# System resource usage
docker system df
docker system events

# Check Docker daemon logs
sudo tail -f /var/log/docker.log
journalctl -u docker.service --since "1 hour ago"
```

### Environment Verification
```bash
# Check environment variables
env | grep -i docker
echo $DOCKER_HOST
echo $DOCKER_CERT_PATH

# Verify Docker installation
docker run hello-world
```

### Network and Storage
```bash
# Check Docker networks
docker network ls

# Check Docker volumes
docker volume ls

# Check disk usage
docker system df
df -h /var/lib/docker
```

## Quick Fixes Reference

| Issue | Quick Fix |
|-------|-----------|
| Permission denied | `sudo usermod -aG docker $USER && newgrp docker` |
| Command not found | `export PATH=$PATH:/usr/bin:/usr/local/bin` |
| Daemon not running | `sudo systemctl start docker` |
| Socket connection error | `sudo chmod 666 /var/run/docker.sock` |
| WSL2 issues (Windows) | `wsl --update && wsl --set-default-version 2` |
| Service startup failure | `sudo systemctl daemon-reload && sudo systemctl restart docker` |

This comprehensive troubleshooting guide covers the fundamental Docker installation and setup issues. Each section provides both diagnostic commands and practical solutions for common problems across different operating systems.

Sources
